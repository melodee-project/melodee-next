# Production Configuration for Melodee

# Server Configuration
server:
  host: "0.0.0.0"
  port: 8080
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s

# Database Configuration
database:
  host: "${MELODEE_DB_HOST:-localhost}"
  port: ${MELODEE_DB_PORT:-5432}
  user: "${MELODEE_DB_USER:-melodee}"
  password: "${MELODEE_DB_PASSWORD}"
  db_name: "${MELODEE_DB_NAME:-melodee}"
  ssl_mode: "${MELODEE_DB_SSL_MODE:-disable}"
  max_open_conns: 100
  max_idle_conns: 50
  conn_max_lifetime: 30m
  conn_max_idle_time: 15m

# Redis Configuration
redis:
  address: "${MELODEE_REDIS_ADDRESS:-localhost:6379}"
  password: "${MELODEE_REDIS_PASSWORD:-}"
  db: 0
  pool_size: 50
  timeout: 5s

# JWT Configuration
jwt:
  secret: "${MELODEE_JWT_SECRET}"
  access_expiry: 15m
  refresh_expiry: 14d

# Storage Configuration
storage:
  base_path: "${MELODEE_STORAGE_PATH:-/melodee/storage}"
  inbound_path: "${MELODEE_INBOUND_PATH:-/melodee/inbound}"
  staging_path: "${MELODEE_STAGING_PATH:-/melodee/staging}"
  quarantine_path: "${MELODEE_QUARANTINE_PATH:-/melodee/quarantine}"
  user_images_path: "${MELODEE_USER_IMAGES_PATH:-/melodee/user_images}"

# Processing Configuration
processing:
  concurrency:
    inbound_validation: "${MELODEE_PROCESSING_INBOUND_WORKERS:-4}"
    staging_promotion: "${MELODEE_PROCESSING_STAGING_WORKERS:-2}"
    transcoding: "${MELODEE_PROCESSING_TRANSCODING_WORKERS:-2}"
  capacity_thresholds:
    warn_percent: 80.0
    alert_percent: 90.0
  ffmpeg_profiles:
    transcode_high: "-c:a libmp3lame -b:a 320k -ar 44100 -ac 2"
    transcode_mid: "-c:a libmp3lame -b:a 192k -ar 44100 -ac 2"
    transcode_opus_mobile: "-c:a libopus -b:a 96k -application audio"
  checksum_enabled: true
  idempotency_enabled: true

# Directory Organization Configuration
directory:
  template: "{artist_dir_code}/{artist}/{year} - {album}"
  code_config:
    max_length: 10
    min_length: 2
    format_pattern: "consonant_vowel"
    use_suffixes: true
    suffix_pattern: "-%d"
    valid_chars: "A-Z0-9"
  library_selection:
    strategy: "directory_code"  # Options: hash, round_robin, directory_code, size_based
    load_balancing:
      enabled: true
      threshold_percentage: 80
    capacity_probe:
      interval: 10m
      stop_threshold_percentage: 90

# Logging Configuration
logging:
  level: "info"
  format: "json"
  output: "stdout"
  structured: true
  fields:
    service: "melodee"
    version: "1.0.0"

# Metrics Configuration
metrics:
  enabled: true
  path: "/metrics"
  collect_system_metrics: true

# Tracing Configuration (optional)
tracing:
  enabled: false
  endpoint: "${MELODEE_TRACING_ENDPOINT:-http://jaeger:14268/api/traces}"
  sampler_rate: 0.1

# Health Check Configuration
health:
  enabled: true
  path: "/healthz"
  db_ping_timeout: 200ms
  redis_ping_timeout: 100ms
  thresholds:
    db_latency_warn: 200ms
    db_latency_alert: 500ms
    redis_latency_warn: 100ms
    redis_latency_alert: 250ms

# External Services
external:
  ffmpeg_path: "${FFMPEG_PATH:-/usr/bin/ffmpeg}"
  capacity_probes:
    command: "df --output=pcent {path}"
    interval: 10m
    thresholds:
      warn: 80
      alert: 90

# Bootstrap Configuration
bootstrap:
  admin_password_env: "MELODEE_BOOTSTRAP_ADMIN_PASSWORD"